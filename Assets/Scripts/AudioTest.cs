using System.Collections;
using System.Collections.Generic;
using UnityEngine;

[RequireComponent(typeof(AudioSource))]
public class AudioTest : MonoBehaviour {
    private float startTime = 0f;
    private int nextOnset = 0;
    private AudioSource audio;
    public LaserWeapon laserPrefab;
    public Targetable target;
    public Transform laserParent;

    private void Awake() {
        if (Application.isEditor)
         Application.runInBackground = true;
    }

    void Start() {
        Restart();
    }

    public void Restart() {
        startTime = Time.time;
        nextOnset = 0;
        audio = GetComponent<AudioSource>();
        audio.Stop();
        audio.Play();
    }
    void Update() {
        if (!audio.isPlaying) {
            Restart();
        }
        if (nextOnset < onsets.Length) {
            var time = Time.time - startTime;
            if (time >= onsets[nextOnset]) {
                FireOnce();
                ++nextOnset;
            }
        }
    }
    void FireOnce() {
        var laser = GameObject.Instantiate(laserPrefab, laserParent);
        laser.Fire(transform, target, 0f);

    }
    float[] onsets = {
        0.069660f, 0.185760f, 0.301859f, 0.394739f, 0.510839f, 0.719819f, 0.835918f, 0.952018f, 1.068118f, 1.160998f,
        1.369977f, 1.602177f, 1.718277f, 1.811156f, 1.927256f, 2.043356f, 2.159456f, 2.252336f, 2.484535f, 2.600635f,
        2.693515f, 2.809615f, 2.925714f, 3.041814f, 3.134694f, 3.343673f, 3.459773f, 3.575873f, 3.691973f, 3.808073f,
        3.900952f, 4.017052f, 4.226032f, 4.342132f, 4.458231f, 4.574331f, 4.667211f, 4.876190f, 5.108390f, 5.224490f,
        5.317370f, 5.433469f, 5.549569f, 5.665669f, 5.758549f, 5.967528f, 6.083628f, 6.199728f, 6.315828f, 6.431927f,
        6.548027f, 6.640907f, 6.849887f, 7.082086f, 7.314286f, 7.500045f, 7.732245f, 7.848345f, 7.964444f, 8.057324f,
        8.173424f, 8.289524f, 8.382404f, 8.591383f, 8.730703f, 8.823583f, 8.939683f, 9.055782f, 9.171882f, 9.264762f,
        9.473741f, 9.613061f, 9.705941f, 9.822041f, 9.938141f, 10.054240f, 10.147120f, 10.356100f, 10.472200f,
        10.565079f, 10.704399f, 10.797279f, 10.936599f, 11.006259f, 11.238458f, 11.354558f, 11.447438f, 11.563537f,
        11.679637f, 11.795737f, 11.888617f, 12.097596f, 12.236916f, 12.329796f, 12.445896f, 12.561995f, 12.678095f,
        12.770975f, 12.979955f, 13.096054f, 13.212154f, 13.328254f, 13.421134f, 13.560454f, 13.653333f, 13.862313f,
        13.978413f, 14.071293f, 14.210612f, 14.303492f, 14.419592f, 14.512472f, 14.744671f, 14.860771f, 14.953651f,
        15.069751f, 15.185850f, 15.301950f, 15.394830f, 15.603810f, 15.743129f, 15.836009f, 15.952109f, 16.068209f,
        16.184308f, 16.277188f, 16.486168f, 16.602268f, 16.718367f, 16.834467f, 16.927347f, 17.136327f, 17.368526f,
        17.484626f, 17.577506f, 17.716825f, 17.809705f, 17.925805f, 18.018685f, 18.250884f, 18.366984f, 18.459864f,
        18.575964f, 18.692063f, 18.808163f, 18.901043f, 19.110023f, 19.249342f, 19.342222f, 19.458322f, 19.551202f,
        19.690522f, 19.783401f, 19.992381f, 20.108481f, 20.201361f, 20.340680f, 20.433560f, 20.549660f, 20.642540f,
        20.874739f, 20.990839f, 21.083719f, 21.223039f, 21.315918f, 21.432018f, 21.524898f, 21.733878f, 21.873197f,
        21.966077f, 22.082177f, 22.198277f, 22.314376f, 22.407256f, 22.616236f, 22.732336f, 22.848435f, 22.964535f,
        23.057415f, 23.173515f, 23.266395f, 23.498594f, 23.614694f, 23.707574f, 23.823673f, 23.939773f, 24.055873f,
        24.148753f, 24.380952f, 24.497052f, 24.589932f, 24.706032f, 24.822132f, 24.938231f, 25.031111f, 25.240091f,
        25.379410f, 25.472290f, 25.588390f, 25.681270f, 25.797370f, 25.913469f, 26.122449f, 26.238549f, 26.354649f,
        26.470748f, 26.563628f, 26.679728f, 26.772608f, 27.004807f, 27.120907f, 27.213787f, 27.329887f, 27.445986f,
        27.562086f, 27.654966f, 27.863946f, 28.003265f, 28.096145f, 28.212245f, 28.328345f, 28.444444f, 28.537324f,
        28.746304f, 28.885624f, 28.978503f, 29.094603f, 29.187483f, 29.303583f, 29.419683f, 29.628662f, 29.744762f,
        29.860862f, 29.976961f, 30.069841f, 30.185941f, 30.278821f, 30.511020f, 30.627120f, 30.720000f, 30.836100f,
        30.952200f, 31.068299f, 31.161179f, 31.370159f, 31.509478f, 31.602358f, 31.718458f, 31.834558f, 31.950658f,
        32.043537f, 32.159637f, 32.252517f, 32.368617f, 32.484717f, 32.600816f, 32.693696f, 32.809796f, 32.902676f,
        33.134875f, 33.250975f, 33.367075f, 33.483175f, 33.576054f, 33.692154f, 33.785034f, 33.994014f, 34.133333f,
        34.226213f, 34.342313f, 34.458413f, 34.574512f, 34.667392f, 34.899592f, 35.108571f, 35.549751f, 35.758730f,
        35.990930f, 36.199909f, 36.408889f, 36.873288f, 37.082268f, 37.314467f, 37.523447f, 37.639546f, 37.755646f,
        38.173605f, 38.382585f, 38.614785f, 38.846984f, 39.055964f, 39.264943f, 39.706122f, 39.915102f, 40.379501f,
        40.588481f, 40.797460f, 41.029660f, 41.238639f, 41.470839f, 41.679819f, 41.888798f, 42.004898f, 42.120998f,
        42.353197f, 42.562177f, 42.771156f, 43.212336f, 43.421315f, 43.885714f, 44.071474f, 44.303673f, 44.512653f,
        44.651973f, 44.744853f, 45.186032f, 45.395011f, 45.511111f, 45.627211f, 46.068390f, 46.277370f, 46.695329f,
        46.927528f, 47.368707f, 47.577687f, 47.809887f, 48.018866f, 48.251066f, 48.483265f, 48.669025f, 48.901224f,
        49.017324f, 49.574603f, 49.783583f, 49.899683f, 50.224762f, 50.433741f, 50.665941f, 50.874921f, 51.107120f,
        51.316100f, 51.548299f, 52.198458f, 52.407438f, 52.616417f, 52.848617f, 53.057596f, 53.289796f, 53.405896f,
        53.614875f, 53.939955f, 54.172154f, 54.381134f, 54.613333f, 54.822313f, 55.031293f, 55.472472f, 55.704671f,
        55.913651f, 56.122630f, 56.354830f, 56.563810f, 56.796009f, 57.237188f, 57.446168f, 57.655147f, 57.887347f,
        58.119546f, 58.328526f, 58.537506f, 58.653605f, 58.978685f, 59.210884f, 59.419864f, 59.628844f, 59.861043f,
        60.070023f, 60.302222f, 60.418322f, 60.627302f, 60.743401f, 60.952381f, 61.161361f, 61.393560f, 61.625760f,
        61.834739f, 62.043719f, 62.275918f, 63.135057f, 63.367256f, 63.576236f, 63.785215f, 63.901315f, 64.017415f,
        64.133515f, 64.226395f, 64.342494f, 64.458594f, 64.574694f, 64.667574f, 64.783673f, 64.899773f, 64.992653f,
        65.108753f, 65.224853f, 65.317732f, 65.549932f, 65.666032f, 65.758912f, 65.875011f, 65.991111f, 66.107211f,
        66.200091f, 66.409070f, 66.548390f, 66.641270f, 66.757370f, 66.850249f, 66.989569f, 67.082449f, 67.291429f,
        67.407528f, 67.523628f, 67.639728f, 67.732608f, 67.848707f, 67.964807f, 68.080907f, 68.173787f, 68.289887f,
        68.382766f, 68.522086f, 68.614966f, 68.731066f, 68.823946f, 69.056145f, 69.172245f, 69.265125f, 69.381224f,
        69.497324f, 69.613424f, 69.706304f, 69.915283f, 70.031383f, 70.147483f, 70.263583f, 70.356463f, 70.495782f,
        70.565442f, 70.704762f, 70.797642f, 70.913741f, 71.029841f, 71.145941f, 71.238821f, 71.354921f, 71.471020f,
        71.680000f, 71.796100f, 71.888980f, 72.005079f, 72.121179f, 72.237279f, 72.330159f, 72.562358f, 72.678458f,
        72.771338f, 72.887438f, 73.003537f, 73.119637f, 73.212517f, 73.328617f, 73.421497f, 73.537596f, 73.630476f,
        73.769796f, 73.862676f, 73.978776f, 74.071655f, 74.303855f, 74.419955f, 74.536054f, 74.652154f, 74.745034f,
        74.861134f, 74.954014f, 75.186213f, 75.302313f, 75.395193f, 75.511293f, 75.627392f, 75.743492f, 75.836372f,
        76.045351f, 76.184671f, 76.277551f, 76.393651f, 76.486531f, 76.625850f, 76.718730f, 76.927710f, 77.043810f,
        77.136689f, 77.276009f, 77.368889f, 77.484989f, 77.577868f, 77.810068f, 77.926168f, 78.019048f, 78.135147f,
        78.251247f, 78.367347f, 78.460227f, 78.576327f, 78.692426f, 78.808526f, 78.901406f, 79.017506f, 79.133605f,
        79.249705f, 79.342585f, 79.574785f, 79.667664f, 79.783764f, 79.899864f, 79.992744f, 80.132063f, 80.224943f,
        80.341043f, 80.433923f, 80.550023f, 80.642902f, 80.782222f, 80.875102f, 80.991202f, 81.084082f, 81.316281f,
        81.432381f, 81.525261f, 81.641361f, 81.757460f, 81.873560f, 81.966440f, 82.082540f, 82.198639f, 82.314739f,
        82.407619f, 82.523719f, 82.616599f, 82.755918f, 82.825578f, 83.057778f, 83.289977f, 83.406077f, 83.498957f,
        83.731156f, 83.847256f, 83.940136f, 84.056236f, 84.149116f, 84.288435f, 84.381315f, 84.497415f, 84.590295f,
        84.822494f, 84.938594f, 85.031474f, 85.147574f, 85.263673f, 85.379773f, 85.472653f, 85.588753f, 85.681633f,
        85.797732f, 85.913832f, 86.029932f, 86.122812f, 86.262132f, 86.331791f, 86.563991f, 86.680091f, 86.796190f,
        86.912290f, 87.005170f, 87.121270f, 87.214150f, 87.423129f, 87.562449f, 87.655329f, 87.771429f, 87.887528f,
        88.003628f, 88.096508f, 88.328707f, 88.444807f, 88.537687f, 88.653787f, 88.769887f, 88.885986f, 88.978866f,
        89.094966f, 89.187846f, 89.303946f, 89.420045f, 89.536145f, 89.629025f, 89.768345f, 89.838005f, 90.070204f,
        90.186304f, 90.279184f, 90.395283f, 90.511383f, 90.627483f, 90.720363f, 90.929342f, 91.068662f, 91.161542f,
        91.277642f, 91.393741f, 91.602721f, 91.834921f, 91.951020f, 92.043900f, 92.160000f, 92.252880f, 92.485079f,
        92.694059f, 92.903039f, 93.042358f, 93.135238f, 93.344218f, 93.576417f, 93.692517f, 93.785397f, 93.901497f,
        94.017596f, 94.133696f, 94.226576f, 94.435556f, 94.574875f, 94.667755f, 94.783855f, 94.899955f, 95.108934f,
        95.341134f, 95.434014f, 95.550113f, 95.666213f, 95.759093f, 95.991293f, 96.200272f, 96.316372f, 96.409252f,
        96.641451f, 96.850431f, 97.082630f, 97.198730f, 97.291610f, 97.407710f, 97.523810f, 97.639909f, 97.732789f,
        97.941769f, 98.057868f, 98.173968f, 98.290068f, 98.382948f, 98.615147f, 98.824127f, 98.940227f, 99.056327f,
        99.172426f, 99.265306f, 99.497506f, 99.706485f, 99.915465f, 100.147664f, 100.356644f, 100.588844f, 100.704943f,
        100.797823f, 100.913923f, 101.030023f, 101.146122f, 101.239002f, 101.447982f, 101.564082f, 101.680181f,
        101.796281f, 101.912381f, 102.098141f, 102.330340f, 102.446440f, 102.562540f, 102.771519f, 103.003719f,
        103.212698f, 103.421678f, 103.653878f, 103.862857f, 104.095057f, 104.211156f, 104.304036f, 104.420136f,
        104.536236f, 104.652336f, 104.745215f, 104.954195f, 105.163175f, 105.627574f, 105.743673f, 105.836553f,
        106.068753f, 106.277732f, 106.486712f, 106.718912f, 106.927891f, 107.043991f, 107.160091f, 107.369070f,
        107.485170f, 107.578050f, 107.694150f, 107.810249f, 107.926349f, 108.042449f, 108.251429f, 108.460408f,
        108.576508f, 108.692608f, 108.901587f, 109.110567f, 109.249887f, 109.342766f, 109.574966f, 109.760726f,
        109.992925f, 110.225125f, 110.434104f, 110.550204f, 110.643084f, 110.875283f, 110.991383f, 111.084263f,
        111.200363f, 111.316463f, 111.432562f, 111.525442f, 111.734422f, 111.966621f, 112.082721f, 112.198821f,
        112.407800f, 112.616780f, 112.732880f, 112.848980f, 113.057959f, 113.266939f, 113.499138f, 113.731338f,
        113.940317f, 114.056417f, 114.149297f, 114.381497f, 114.497596f, 114.590476f, 114.706576f, 114.822676f,
        114.938776f, 115.031655f, 115.240635f, 115.472834f, 115.588934f, 115.681814f, 115.914014f, 116.122993f,
        116.239093f, 116.355193f, 116.564172f, 116.773152f, 117.005351f, 117.237551f, 117.446531f, 117.562630f,
        117.655510f, 117.887710f, 118.003810f, 118.096689f, 118.212789f, 118.328889f, 118.444989f, 118.537868f,
        118.746848f, 118.979048f
    };
}
